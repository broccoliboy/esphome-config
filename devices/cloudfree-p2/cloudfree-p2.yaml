substitutions:
  # default name is used as base for MAC suffix unique name generated by ESPHome
  name: "cloudfree-p2"
  friendly_name: "Cloudfree Smart Plug"
  device_description: "CloudFree Smart Plug (P2) Power Monitoring Plug with button and Blue led"
  current_res: "0.00221" # Random value. Requires power monitoring calibration
  voltage_div: "955" # Random value. Requires power monitoring calibration

esphome:
  project:
    name: broccoliboy.cloudfree-p2
    version: "1.0"

packages:
  hardware: !include ../../hardware/esp01_1m.yaml
  base: !include ../../common/base.yaml

status_led:
  pin:
    number: GPIO2
    inverted: true

output:
  - platform: gpio
    id: relay_gpio
    pin:
      number: GPIO4
  - platform: gpio
    id: relay_led_gpio
    pin:
      number: GPIO0
      inverted: true

switch:
  - platform: output
    id: cloudfree_switch
    name: "Switch"
    output: relay_gpio
    on_turn_on:
      - output.turn_on: relay_led_gpio
    on_turn_off:
      - output.turn_off: relay_led_gpio

binary_sensor:
  - platform: gpio
    id: cloudfree_button
    device_class: power
    pin:
      number: GPIO13
      mode: INPUT_PULLUP
      inverted: True
    on_press:
      - switch.toggle: cloudfree_switch

# sensor:
#   - platform: hlw8012
#     sel_pin:
#       number: GPIO12
#       inverted: true
#     cf_pin: GPIO05
#     cf1_pin: GPIO14
#     change_mode_every: 8
#     update_interval: 10s
#     current:
#       name: Current
#       unit_of_measurement: A
#     voltage:
#       name: Voltage
#       unit_of_measurement: V
#     power:
#       name: Power
#       unit_of_measurement: W
#     current_resistor: ${current_res}
#     voltage_divider: ${voltage_div}

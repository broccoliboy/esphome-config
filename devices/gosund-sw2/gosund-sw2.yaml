substitutions:
  # default name is used as base for MAC suffix unique name generated by ESPHome
  name: "gosund-sw2"
  friendly_name: "Gosund SW2 Wall Dimmer Switch"

esphome:
  project:
    name: broccoliboy.gosund-sw2
    version: "2.0"

# import baseline hardware and common components
packages:
  hardware: !include ../../hardware/esp01_1m.yaml
  base: !include ../../common/base.yaml

# import the gosund-sw2 component externally. For some reason local import isn't working for this component.
external_components:
  # - source: components # uncomment to use local components folder for development
  - source: github://broccoliboy/esphome-config
    refresh: 0s
    components: [ gosund_sw2 ]

# configurations specific to this device
logger:
  level: ${log_level}
  baud_rate: 0  # This must be 0 to prevent conflicts with the dimmer

status_led:
  pin:
    number: GPIO12
    inverted: true

output:
  - platform: gpio
    id: gosund_indicator
    pin:
      number: GPIO13
      inverted: true

binary_sensor:
  - platform: gpio
    id: gpio0
    pin:
      number: GPIO0
      mode: INPUT_PULLUP
  - platform: gpio
    id: gosund_button
    pin:
      number: GPIO4
      mode: INPUT_PULLUP
      inverted: true
    on_click:
      min_length: 50ms
      max_length: 500ms
      then:
        - light.toggle: gosund_sw2_light

uart:
  - id: gosund_uart
    rx_pin: GPIO3
    tx_pin: GPIO1
    baud_rate: 115200

light:
  - platform: gosund_sw2
    id: gosund_sw2_light
    name: "Dimmer"  # need name so light will show up in Home Assistant
    indicator: gosund_indicator

number:
  - platform: template
    name: "Output range min"
    id: output_range_min
    min_value: 0
    max_value: 1
    step: 0.01
    restore_value: true
    initial_value: 0
    optimistic: true
    set_action:
      then:
        lambda: "gosund_sw2_gosundsw2->set_output_min(x);"
  - platform: template
    name: "Output range max"
    id: output_range_max
    min_value: 0
    max_value: 1
    step: 0.01
    restore_value: true
    initial_value: 1
    optimistic: true
    set_action:
      then:
        lambda: "gosund_sw2_gosundsw2->set_output_max(x);"
  - platform: template
    name: "Gamma"
    id: output_gamma
    min_value: 0.5
    max_value: 3.0
    step: 0.1
    restore_value: true
    initial_value: 1.0
    optimistic: true
    set_action:
      then:
        lambda: "gosund_sw2_gosundsw2->set_output_gamma(x);"

substitutions:
  # default name is used as base for MAC suffix unique name generated by ESPHome
  name: "gosund-sw2"
  friendly_name: "Gosund SW2 Dimmer Switch"

esphome:
  project:
    name: broccoliboy.gosund-sw2
    version: "1.0"
  includes:
    - devices/gosund-sw2/gosund-sw2.h

packages:
  hardware: !include ../../hardware/esp01_1m.yaml
  base: !include ../../components/base.yaml

logger:
  level: INFO
  baud_rate: 0  # This must be 0 to prevent conflicts with the dimmer

status_led:
  pin:
    number: GPIO13
    inverted: true

number:
  - platform: template
    name: "Output range min"
    id: output_range_min
    optimistic: true
    min_value: 0
    max_value: 100
    step: 1
    restore_value: true
    initial_value: 0
  - platform: template
    name: "Output range max"
    id: output_range_max
    optimistic: true
    min_value: 0
    max_value: 100
    step: 1
    restore_value: true
    initial_value: 100

uart:
  - id: uart_bus
    rx_pin: GPIO3
    tx_pin: GPIO1
    baud_rate: 115200

custom_component:
- lambda: |-
    auto gosund_sw2 = new GosundSW2(id(uart_bus));
    return {gosund_sw2};

output:
- platform: gpio
  id: led0
  pin: GPIO12



switch:
- platform: output
  name: "Relay"
  id: switch0
  output: led0
  # on_turn_on:
  #   - output.turn_on: led0
  # on_turn_off:
  #   - output.turn_off: led0

binary_sensor:
  - platform: gpio
    id: button0
    pin:
      number: GPIO4
      mode:
        input: true
        pullup: true
      inverted: true
    on_click:
      min_length: 50ms
      max_length: 500ms
      then:
        - switch.toggle: switch0

substitutions:
  # default name is used as base for MAC suffix unique name generated by ESPHome
  name: "gosund-sw2"
  friendly_name: "Gosund SW2 Wall Dimmer Switch"

esphome:
  project:
    name: broccoliboy.gosund-sw2
    version: "1.0"

packages:
  hardware: !include ../../hardware/esp01_1m.yaml
  base: !include ../../common/base.yaml

external_components:
  - source: github://broccoliboy/esphome-config
    refresh: 0s
    components: [ gosund_sw2 ]

logger:
  level: ${log_level}
  baud_rate: 0  # This must be 0 to prevent conflicts with the dimmer

status_led:
  pin:
    number: GPIO12
    inverted: true

output:
  - platform: gpio
    id: gosund_indicator
    pin: GPIO13

binary_sensor:
  - platform: gpio
    id: gpio0
    pin:
      number: GPIO0
      mode: INPUT_PULLUP
  - platform: gpio
    id: gosund_button
    pin:
      number: GPIO4
      mode: INPUT_PULLUP
      inverted: true
    on_click:
      min_length: 50ms
      max_length: 500ms
      then:
        - light.toggle: gosund_sw2_0

uart:
  - id: gosund_uart
    rx_pin: GPIO3
    tx_pin: GPIO1
    baud_rate: 115200

light:
  - platform: gosund_sw2
    id: gosund_sw2_0
    name: "Dimmer"  # need name so light will show up in Home Assistant
    indicator: gosund_indicator

# number:
#   - platform: template
#     name: "Output range min"
#     id: output_range_min
#     optimistic: true
#     min_value: 0
#     max_value: 100
#     step: 1
#     restore_value: true
#     initial_value: 0
#   - platform: template
#     name: "Output range max"
#     id: output_range_max
#     optimistic: true
#     min_value: 0
#     max_value: 100
#     step: 1
#     restore_value: true
#     initial_value: 100
